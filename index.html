<!doctype html> 
<html lang="en"> 
<head> 
	<meta charset="UTF-8" />
	<title>Game</title>
	<script type="text/javascript" src="js/phaser.js"></script>
    <style type="text/css">
        body {
            margin: 0;
        }
    </style>
</head>
<body>

<script type="text/javascript">

var game = new Phaser.Game(800, 600, Phaser.AUTO, '', { preload: preload, create: create, update: update });


var blobs;

function preload() {
	game.load.image('blob', 'sprite.png');
}


function create() {

	blobs= game.add.group();
	game.physics.startSystem(Phaser.Physics.ARCADE);

	//creating the initial blob
	var blob = blobs.create(game.world.centerX,game.world.centerX,'blob');
	blob.anchor.set(0.5);
	blob.inputEnabled= true;
	blob.events.onInputDown.add(listener, this);
	game.physics.enable(blob, Phaser.Physics.ARCADE);
	blob.body.velocity.setTo(150,150);
	blob.body.collideWorldBounds=true;
	blob.body.bounce.set(1);
}

function update() {
	blobs.callAllExists(checkOutofBounds);
}

function checkOutofBounds(blob){
	if(blob.x<10 || blob.y <10){
		gameOver();
	}
}

function listener(blob) {
	//console.log("here");
	
	createBlob(blob);
	if(blob.scale.x>.1){
		createBlob(blob, blobs);
	}

	blob.destroy();
}

function createBlob(oldBlob){
	var blob = blobs.create(oldBlob.x,oldBlob.y,'blob');

	if(oldBlob.scale.x>.25){
		blob.scale.setTo(oldBlob.scale.x * .5,oldBlob.scale.y * .5);
	}
	else{
		blob.scale.setTo(.1, .1);
	}
	blob.inputEnabled= true;
	blob.events.onInputDown.add(listener, this);

	game.physics.enable(blob, Phaser.Physics.ARCADE);
	blob.body.collideWorldBounds=true;
	blob.body.bounce.set(1);

	vel = getVelocity(oldBlob);

	var vx = game.rnd.realInRange(-vel[0], vel[0]);
	var vy = game.rnd.realInRange(-vel[1], vel[1]);
	blob.body.velocity.setTo(vx, vy);

}

function getVelocity(oldBlob){
	return [-50,50];
}

function gameOver(){
	console.log('game over!');
}

</script>

</body>
</html>