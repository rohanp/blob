<!doctype html> 
<html lang="en"> 
<head> 
	<meta charset="UTF-8" />
	<title>Game</title>
	<script type="text/javascript" src="js/phaser.js"></script>
    <style type="text/css">
        body {
            margin: 0;
        }
    </style>
</head>
<body>

<script type="text/javascript">

var game = new Phaser.Game(800, 600, Phaser.AUTO, '', { preload: preload, create: create, update: update });


var blobs;
var bigText;
var bigStyle;
var timer;
var timerText;
var smallStyle;
var cSec;

function preload() {
	game.load.image('blob', 'sprite.png');
}


function create() {
	timer = game.time.create(false);
	timer.loop(10, updateTime, this);
	var text="Time: "
	cSec=0;
	smallStyle = { font: "45px Arial", fill: "#ffffff", align: "center" };
	timerText = game.add.text(20, game.world._height-50, text, smallStyle);
	timer.start();

	blobs= game.add.group();
	game.physics.startSystem(Phaser.Physics.ARCADE);

	//creating the initial blob
	var blob = blobs.create(game.world.centerX,game.world.centerX,'blob');
	blob.anchor.setTo(.5,null);
	blob.anchor.set(0.5);
	blob.inputEnabled= true;
	blob.events.onInputDown.add(listener, this);
	game.physics.enable(blob, Phaser.Physics.ARCADE);
	blob.body.velocity.setTo(50,50);
	blob.body.collideWorldBounds=true;
	blob.body.bounce.set(1);

	//createBlob(blob);

}

function update() {
	blobs.forEachExists(function checkOutofBounds(blob){
	if( blob.x -blob.width/2<=0 || blob.y-blob.height/2<=0 || blob.y+ blob.height/2>=game.world._height || blob.x +blob.width/2>= game.world._width){
		gameOver();
	}
	});
}

function updateTime() {
	timerText.setText(cSec/100);
	cSec+=1;
}

function listener(blob) {
	//console.log("here");
	
	createBlob(blob);
	if(blob.scale.x>.1){
		createBlob(blob, blobs);
	}

	blob.destroy();
}



function createBlob(oldBlob){
	var blob = blobs.create(oldBlob.x,oldBlob.y,'blob');
	//blob.setAnchor
	if(oldBlob.scale.x>.25){
		blob.scale.setTo(oldBlob.scale.x * .5,oldBlob.scale.y * .5);
	}
	else{
		blob.scale.setTo(.1, .1);
	}

	blob.anchor.setTo(0.5,null);
	blob.inputEnabled= true;
	blob.events.onInputDown.add(listener, this);

	game.physics.enable(blob, Phaser.Physics.ARCADE);
	//blob.body.collideWorldBounds=true;
	blob.body.bounce.set(1);

	blob.body.collideWorldBounds=true;

	var vx = game.rnd.realInRange(-oldBlob.body.velocity.x*1.2, oldBlob.body.velocity.x*1.2);
	var vy = game.rnd.realInRange(-oldBlob.body.velocity.y*1.2, oldBlob.body.velocity.y*1.2);

	if(oldBlob.body.velocity.x*vx>0){
		vx=vx*-1;
	}
	if(oldBlob.body.velocity.y*vy>0){
		vy=vy*-1;
	}

	blob.body.velocity.setTo(vx, vy);

}



function gameOver(){
	blobs.forEachExists(function freeze(blob){
		blob.body.velocity.setTo(0,0);
		blob.events.onInputDown.removeAll();
		timer.stop();
	});
	bigText="Game Over!"
	bigStyle = { font: "65px Arial", fill: "#ffffff", align: "center" };

	game.add.text(game.world.centerX-170, 0, bigText, bigStyle);

}

</script>

</body>
</html>